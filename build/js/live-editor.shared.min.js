"undefined"!=typeof Handlebars&&(Handlebars.registerHelper("_",function(e){return e.fn(this)}),Handlebars.registerHelper("i18nDoNotTranslate",function(e){return e.fn(this)})),jQuery._=function(e){return e};
$._||($._=function(o){return o}),window.OutputImages=[{groupName:"creatures",images:"Hopper-Happy Hopper-Cool Hopper-Jumping OhNoes BabyWinston Winston".split(" ")},{groupName:"cute",images:"Blank BrownBlock CharacterBoy CharacterCatGirl CharacterHornGirl CharacterPinkGirl CharacterPrincessGirl ChestClosed ChestLid ChestOpen DirtBlock DoorTallClosed DoorTallOpen EnemyBug GemBlue GemGreen GemOrange GrassBlock Heart Key PlainBlock RampEast RampNorth RampSouth RampWest Rock RoofEast RoofNorth RoofNorthEast RoofNorthWest RoofSouth RoofSouthEast RoofSouthWest RoofWest Selector ShadowEast ShadowNorth ShadowNorthEast ShadowNorthWest ShadowSideWest ShadowSouth ShadowSouthEast ShadowSouthWest ShadowWest Star StoneBlock StoneBlockTall TreeShort TreeTall TreeUgly WallBlock WallBlockTall WaterBlock WindowTall WoodBlock".split(" "),cite:$._("'Planet Cute' art by Daniel Cook (Lostgarden.com)"),citeLink:"http://lostgarden.com/2007/05/dancs-miraculously-flexible-game.html"},{groupName:"space",images:"background beetleship collisioncircle girl1 girl2 girl3 girl4 girl5 healthheart minus octopus planet plus rocketship star 0 1 2 3 4 5 6 7 8 9".split(" "),cite:$._("'Space Cute' art by Daniel Cook (Lostgarden.com)"),citeLink:"http://lostgarden.com/2007/03/spacecute-prototyping-challenge.html"}];
window.ScratchpadRecord=Backbone.Model.extend({initialize:function(){this.handlers={},this.seekCache={},this.seekCacheInterval=20,this.initData={},this.seekTime=null,this.seekCachers={},this.allSavedCommands=[],this.actualInitData},setActualInitData:function(t){this.actualInitData=t},hasNoChunks:function(){return _.isEmpty(this.allSavedCommands)},numChunksSaved:function(){return this.allSavedCommands.length},startRecordChunk:function(t){function e(){var t=0;return this.allSavedCommands&&this.allSavedCommands.length>0&&_.last(this.allSavedCommands).length>0&&(t=_.last(_.last(this.allSavedCommands)).time),t}t=Math.max(t,e()),this._resetForNewChunk(),this.record(t)},stopRecordChunk:function(){this.stopRecord()},saveRecordChunk:function(){this.allSavedCommands.push(this.commands),this._resetForNewChunk()},discardRecordChunk:function(){this._resetForNewChunk()},_resetForNewChunk:function(){this.commands=[],this.initData={}},record:function(t){t=t||0,this.recording||(this.commands=[],this.recording=!0,this.startTime=(new Date).getTime()-t,this.trigger("recordStarted"))},stopRecord:function(){this.recording&&(this.recording=!1,this.recorded=!0,this.trigger("recordEnded"))},loadRecording:function(t){t&&t.commands&&t.init&&(this.initData=t.init,t=t.commands),this.commands=t},dumpRecording:function(){return this.actualInitData&&(this.initData=this.actualInitData,this.commands=_.flatten(this.allSavedCommands,!0)),{init:this.initData,commands:this.commands}},getVersion:function(){return this.initData.configVersion||0},seekTo:function(t){return this.seekRunning?!1:(this.seekRunning=!0,this.seekTime=t,this.pauseTime=(new Date).getTime(),this.playStart=this.pauseTime-t,void(this.seekInterval||(this.seekInterval=setInterval(_.bind(function(){null!==this.seekTime&&(this.runSeek(this.seekTime),this.seekTime=null)},this),200))))},runSeek:function(t){this.trigger("runSeek",t),this.cache(-1*this.seekCacheInterval);for(var e=this.commands.length,i=0;i<this.commands.length;i++)if(this.commands[i].time>t){e=i-1;break}for(var s=Math.floor(e/this.seekCacheInterval),n=null,a=0,i=s;i>=0;i--)if(this.seekCache[i]){n=i;break}null!==n?(this.cacheRestore(n),a=n*this.seekCacheInterval+1):this.cacheRestore(-1*this.seekCacheInterval),this.runSeekCommands(a,e),this.playPos=e+1},runSeekCommands:function(t,e){for(var i=t;e>=i;i++){var s=_.bind(function(t){var i=this.commands[t];if(i){if(this.runCommand(i),i.copy||i.cut||i.paste||i.key)return setTimeout(_.bind(function(){this.cache(t),this.runSeekCommands(t+1,e)},this),1),!0;this.cache(t)}},this)(i);if(s)return}this.seekRunning=!1,this.trigger("seekDone")},cache:function(t){if(t%this.seekCacheInterval===0){var e=Math.floor(t/this.seekCacheInterval);this.seekCache[e]||(this.seekCache[e]={},_.each(this.seekCachers,function(t,i){this.seekCache[e][i]=t.getState()},this))}},cacheRestore:function(t){this.seekCache[t]&&_.each(this.seekCachers,function(e,i){var s=this.seekCache[t][i];s&&e.restoreState(s)},this)},play:function(){if(!this.recording&&!this.playing&&this.commands&&!this.seekRunning&&0!==this.commands.length){this.trigger("playInit");var t=this.playStart?this.pauseTime-this.playStart:0;this.seekTo(t),this.playing=!0,this.playPos=this.playPos||0,this.playStart=(new Date).getTime()-t,this.playInterval=setInterval(_.bind(function(){if(!this.seekRunning){var t=this.commands[this.playPos];t&&this.currentTime()>=t.time&&(this.runCommand(t),this.cache(this.playPos),++this.playPos===this.commands.length&&(this.stopPlayback(!0),this.trigger("playEnded")))}},this),1),this.trigger("playStarted",t>0)}},pausePlayback:function(t){clearInterval(this.playInterval),this.playing=!1,this.playInterval=null,this.pauseTime=(new Date).getTime(),t||this.trigger("playPaused")},stopPlayback:function(t){this.pausePlayback(t),t||this.trigger("playStopped"),this.playPos=null,this.playStart=null,this.pauseTime=null,clearInterval(this.seekInterval),this.seekInterval=null},reset:function(){this.initData={},this.commands=[],this.seekCache={},this.playPos=null,this.playStart=null,this.pauseTime=null,this.seekTime=null,this.playing=!1,this.recording=!1,this.recorded=!1,clearInterval(this.seekInterval),this.seekInterval=null},currentTime:function(){return(new Date).getTime()-this.playStart},runCommand:function(t){if(t)for(var e in this.handlers)if("undefined"!=typeof t[e])try{return this.handlers[e](t)}catch(i){KAConsole.log("Scratchpad playback error: "),KAConsole.log(i)}},log:function(t){return!this.playing&&this.recording&&this.commands?(t.time=(new Date).getTime()-this.startTime,this.commands.push(t),!0):void 0},pauseLog:function(){this.oldRecording=this.recording,this.recording=!1},resumeLog:function(){this.recording=this.oldRecording},dump:function(){return this.commands?this.commands.map(function(t){var e=[];for(var i in t)"time"!==i&&e.push(i+":"+t[i]);return e.join()}).join():void 0}});
var ScratchpadConfig=Backbone.Model.extend({version:null,initialize:function(e){this.version=e.version,null!=this.version&&(this.version=this.latestVersion())},runCurVersion:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift(this.curVersion()),this.runVersion.apply(this,e)},runVersion:function(e,t){for(var n=Array.prototype.slice.call(arguments,2),i=0;e>=i;i++){var r=this.versions[i][t];r&&r.apply(this,n)}},switchVersion:function(e){e!==this.curVersion()&&(this.version=e,this.trigger("versionSwitched",e))},curVersion:function(){return null!=this.version?this.version:this.latestVersion()},latestVersion:function(){return this.versions.length-1},autoCompleteBehavior:{autoBrace:!1,braceIndent:!0,equalsInsert:!0},bindAutoComplete:function(e,t){t=t||this.autoCompleteBehavior;var n=e.getSession().getMode().$behaviour;n.add("parens","insertion",function(){}),n.add("parens","deletion",function(){}),n.add("brackets","insertion",function(){}),n.add("brackets","deletion",function(){}),n.add("string_dquotes","insertion",function(){}),n.add("string_dquotes","deletion",function(){}),n.add("braces","insertion",function(e,n,i,r,o){var s=i.getCursorPosition(),a=r.doc.getLine(s.row);if("{"===o){var u=i.getSelectionRange(),c=r.doc.getTextRange(u);if(t.autoBrace)return""!==c?{text:"{"+c+"}",selection:!1}:{text:"{}",selection:[1,1]};if(t.braceIndent){var l=/=\s*function/.test(a)?";":"",d=this.getNextLineIndent(e,a.substring(0,a.length-1),r.getTabString()),g=this.$getIndent(r.doc.getLine(s.row));return d===g&&(d+=r.getTabString()),{text:"{\n"+d+c+"\n"+g+"}"+l,selection:[1,d.length,1,d.length]}}}else if("}"===o){var h=a.substring(s.column,s.column+1);if("}"===h){var f=r.$findOpeningBracket("}",{column:s.column+1,row:s.row});if(null!==f)return{text:"",selection:[1,1]}}}else if("\n"===o){var h=a.substring(s.column,s.column+1);if("}"===h){var p=r.findMatchingBracket({row:s.row,column:s.column+1});if(!p)return null;var d=this.getNextLineIndent(e,a.substring(0,a.length-1),r.getTabString()),g=this.$getIndent(r.doc.getLine(p.row));return{text:"\n"+d+"\n"+g,selection:[1,d.length,1,d.length]}}}}),n.add("equals","insertion",function(e,n,i,r,o){if(t.equalsInsert){var s=i.getCursorPosition(),a=r.doc.getLine(s.row);if("="===o&&/\bdraw\s*$/.test(a)){var u=i.getSelectionRange(),c=r.doc.getTextRange(u),l=this.getNextLineIndent(e,a.substring(0,a.length-1),r.getTabString()),d=this.$getIndent(r.doc.getLine(s.row));return l===d&&(l+=r.getTabString()),{text:"= function() {\n"+l+c+"\n"+d+"};",selection:[1,l.length,1,l.length]}}}})},versions:[{name:"Initial Configuration",editor:function(e){e.setHighlightActiveLine(!1),e.$highlightBrackets=function(){},e.renderer.setHScrollBarAlwaysVisible(!1);var t=e.getSession();t.setUseWrapMode(!0),t.setUseSoftTabs(!0),t.setUseWorker(!1),e.setFontSize("14px"),e.setHighlightSelectedWord(!1),e.renderer.setShowGutter(!0),e.renderer.setShowPrintMargin(!1),t.setMode("ace/mode/javascript"),e.setTheme("ace/theme/textmate"),this.bindAutoComplete(e,{autoBrace:!0})},jshint:function(){"undefined"!=typeof Output&&(Output.JSHint={undef:!0,noempty:!0,plusplus:!0,noarg:!0,latedef:!0,eqeqeq:!0,curly:!0,shadow:!0})},processing:function(e){e.size(400,400),e.frameRate(30),e.angleMode="radians"}},{name:"Switch to Degress from Radians",processing:function(e){e.angleMode="degrees"}},{name:"Brace Autocompletion Changes",editor:function(e){this.bindAutoComplete(e,{autoBrace:!1,braceIndent:!0,equalsInsert:!0})}},{name:"Disable Un-needed JSHint Rules",jshint:function(){"undefined"!=typeof Output&&(delete Output.JSHint.noempty,delete Output.JSHint.plusplus)}}]});