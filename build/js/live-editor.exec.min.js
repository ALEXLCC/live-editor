$(document).delegate(".tipbar .tipnav a","click",function(){if(!$(this).hasClass("ui-state-disabled")){var t=$("#output"),a=t.data("tipData");a.pos+=$(this).hasClass("next")?1:-1,t.showTip()}return postParent({focus:!0}),!1}),$(document).delegate(".tipbar.error .text-wrap a","click",function(){var t=$("#output"),a=t.data("tipData"),i=a.Error[a.pos];return postParent({cursor:i}),!1}),$.fn.showTip=function(t,a,i){var s=this.data("tipData");s||(s={pos:0},this.data("tipData",s),this.append($("#tipbar-tmpl").html())),t=t||s.cur,a&&(s.pos=0,s[t]=a,s.callback=i),s.cur=t,a=a||s[t];var e=s.pos,n=this.find(".tipbar").attr("class","tipbar "+t.toLowerCase()).find(".current-pos").text(a.length>1?e+1+"/"+a.length:"").end().find(".message").html(a[e].text||a[e]||"").end().find("a.prev").toggleClass("ui-state-disabled",0===e).end().find("a.next").toggleClass("ui-state-disabled",e+1===a.length).end();return $(".show-me").toggle(-1!==a[e].row),n.find(".tipnav").toggle(a.length>1),n.is(":visible")||n.css({top:400,opacity:.1}).show().animate({top:this.find(".toolbar").is(":visible")?33:100,opacity:1},300),s.callback&&s.callback(a[e]),this},$.fn.hideTip=function(t){var a=this.data("tipData");return!a||t&&t!==a.cur||this.find(".tipbar").animate({top:400,opacity:.1},300,function(){$(this).hide()}),this},$.fn.toggleTip=function(t,a,i){var s=this.data("tipData");return s&&this.find(".tipbar").is(":visible")&&s.cur===t?this.hideTip():this.showTip(t,a,i),this};
var BabyHint={EDIT_DISTANCE_THRESHOLD:2,keywords:["break","case","catch","continue","default","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","while","charAt","charCodeAt","fromCharCode","indexOf","lastIndexOf","length","pop","prototype","push","replace","search","shift","slice","substring","toLowerCase","toUpperCase","unshift"],functionParamCount:{acos:1,asin:1,atan:1,atan2:2,background:[1,3],beginShape:[0,1],bezier:8,bezierVertex:[6],box:[1,2,3],color:[3,4],colorMode:[1,2,4,5],createFont:[1,2],cos:1,curve:8,endShape:[0,1],dist:4,fill:[1,3,4],filter:[1,2],get:[2,3,4,5],image:[3,5],line:4,loadImage:[1,3],mag:[2,3],max:2,min:2,noise:[1,2,3],PVector:[0,2,3],random:[0,1,2],RegExp:[1,2],rect:[4,5],scale:[1,2],set:[3,4],sin:1,stroke:[1,3,4],tan:1,text:[3,5],textFont:[1,2],translate:[2,3],vertex:[2,4]},functionFormSuggestion:{"function":"var drawWinston = function() { ... };","while":"while (x < 20) { ... };"},functionParamBlacklist:["debug","max","min"],bannedProperties:{location:!0,document:!0,ownerDocument:!0,createElement:!0},variables:[],errors:[],inComment:!1,spellChecked:!1,init:function(){for(var e in Output.context)"function"==typeof Output.context[e]&&(BabyHint.keywords.push(e),e in BabyHint.functionParamCount||_.include(BabyHint.functionParamBlacklist,e)||(BabyHint.functionParamCount[e]=Output.context[e].length))},initDocumentation:function(e){for(var n=0;n<e.length;n++){var t=e[n],a=t.indexOf("("),r=t;a>=0&&(r=r.substring(0,a).trim(),BabyHint.functionFormSuggestion[r]=t)}},babyErrors:function(e,n){var t={},a=e.split("\n");return BabyHint.errors=[],BabyHint.variables=[],BabyHint.inComment=!1,BabyHint.spellChecked=!1,_.each(n,function(e){e&&(t[e.line-2]=!0)}),_.each(a,function(e,n){BabyHint.errors=BabyHint.errors.concat(BabyHint.parseLine(e,n,t[n]))}),BabyHint.errors},parseLine:function(e,n,t){var a=[];return BabyHint.inComment&&(e=BabyHint.removeEndOfMultilineComment(e)),BabyHint.inComment||(e=BabyHint.removeComments(e),e=BabyHint.removeStrings(e),a=a.concat(BabyHint.checkFunctionDecl(e,n)).concat(BabyHint.checkTrailingEquals(e,n)).concat(BabyHint.checkFunctionParams(e,n)).concat(BabyHint.checkBannedProperties(e,n)),t&&(a=a.concat(BabyHint.checkSpaceAfterVar(e,n)),BabyHint.spellChecked||(a=a.concat(BabyHint.checkSpelling(e,n)),BabyHint.spellChecked=!0)),BabyHint.variables=BabyHint.variables.concat(BabyHint.getVariables(e))),a},removeComments:function(e){var n=e.indexOf("//");for(-1!==n&&(e=e.slice(0,n));-1!==e.indexOf("/*");){n=e.indexOf("/*");for(var t=e.indexOf("*/");-1!==t&&n+1>=t;)e=e.slice(0,t)+"  "+e.slice(t+2),t=e.indexOf("*/");if(t>n+1){var a=e.slice(n,t+2);e=e.slice(0,n)+a.replace(/./g," ")+e.slice(t+2)}else-1===t&&(BabyHint.inComment=!0,e=e.slice(0,n))}return e},removeEndOfMultilineComment:function(e){var n=e.indexOf("*/");return-1!==n&&(BabyHint.inComment=!1,e=e.slice(0,n+2).replace(/./g," ")+e.slice(n+2)),e},removeStrings:function(e){for(var n=-1,t=null,a=0;a<e.length;a++){var r=e[a];if(-1===n)'"'===r?(n=a,t='"'):"'"===r&&(n=a,t="'");else if(r===t){var i=e.slice(n+1,a);e=e.slice(0,n+1)+i.replace(/./g," ")+e.slice(a),n=-1}}return e},checkFunctionDecl:function(e,n){var t=[],a=e.match(/function\s+\w+/g);return _.each(a,function(a){var r=a.split(/\s+/g)[1],i={row:n,column:e.indexOf(a),text:$._('If you want to define a function, you should use "var %(name)s = function() {}; " instead!',{name:r}),breaksCode:!0,source:"funcdeclaration"};t.push(i)}),t},checkBannedProperties:function(e,n){var t=[],a=e.split(/[^~`@#\$\^\w]/g);return _.each(a,function(a){if(BabyHint.bannedProperties.hasOwnProperty(a)){var r={row:n,column:e.indexOf(a),text:$._("%(word)s is a reserved word.",{word:a}),breaksCode:!0,source:"bannedwords"};t.push(r)}}),t},checkSpelling:function(e,n){var t=[],a=e.split(/[^~`@#\$\^\w]/g),r=!1;return _.each(a,function(a){if(a.length>0&&!r){var i=BabyHint.editDistance(a),o=i.editDistance,c=i.keyword;if(o>0&&o<=BabyHint.EDIT_DISTANCE_THRESHOLD&&o<c.length-1&&-1===BabyHint.keywords.indexOf(a)){var s={row:n,column:e.indexOf(a),text:$._('Did you mean to type "%(keyword)s" instead of "%(word)s"?',{keyword:c,word:a}),breaksCode:!1,source:"spellcheck"};BabyHint.functionFormSuggestion[c]&&(s.text+=" "+$._('In case you forgot, you can use it like "%(usage)s"',{usage:BabyHint.functionFormSuggestion[c]})),t.push(s)}}r="var"===a||"function"===a}),t},editDistance:function(e){var n=e;e=e.toLowerCase();var t=function(e,n,t){t="undefined"==typeof t?0:t;for(var a=[],r=0;e>r;r++){a[r]=[];for(var i=0;n>i;i++)a[r][i]=t}return a},a=1/0,r="";return _.each(BabyHint.keywords.concat(BabyHint.variables),function(i){if(i===n)return a=0,void(r=i);if(i.toLowerCase()===e&&i!==n)return a=1,void(r=i);if(!(Math.abs(i.length-e.length)>BabyHint.EDIT_DISTANCE_THRESHOLD)){var o=i.length,c=e.length,s=t(o,c,1);i[0]===e[0]&&(s[0][0]=0);for(var u=1;c>u;u++){var l=i[0]===e[u]?0:1;s[0][u]=s[0][u-1]+l}for(var f=1;o>f;f++){var l=i[f]===e[0]?0:1;s[f][0]=s[f-1][0]+l}for(var m=1;o>m;m++){for(var d=Number.MAX_VALUE,h=1;c>h;h++){var l=i[m]===e[h]?0:1,v=_.min([s[m-1][h]+1,s[m][h-1]+1,s[m-1][h-1]+l]);d=Math.min(d,v),s[m][h]=v}if(d>BabyHint.EDIT_DISTANCE_THRESHOLD)return}s[o-1][c-1]<a&&(a=s[o-1][c-1],r=i)}}),{editDistance:a,keyword:r}},checkSpaceAfterVar:function(e,n){var t=[],a=/var\w+/g,r=e.match(a);if(r){var i=r[0].slice(3),o={row:n,column:e.search(a)+3,text:$._('Did you forget a space between "var" and "%(variable)s"?',{variable:i}),breaksCode:!1};t.push(o)}return t},checkTrailingEquals:function(e,n){for(var t=[],a=e.length-1;" "===e[a];)a--;if("="===e[a]){var r={row:n,column:a,text:$._('You can\'t end a line with "="'),breaksCode:!0};t.push(r)}return t},getVariables:function(e){var n=[],t=/\s*var\s*([A-z]\w*)\s*(;|=)/;if(t.exec(e)){var a=t.exec(e)[1];n.push(a)}var r=/function\s*\(([\w\s,]*)\)/;if(r.exec(e)){var i=RegExp.$1,o=i.split(/\s*,\s*/);_.each(o,function(e){e&&n.push(e)})}return n},checkFunctionParams:function(e,n){for(var t=[],a={},r=[],i=0;i<e.length;i++)if("("===e[i])r.push(i);else if(")"===e[i]){if(0===r.length){var o={row:n,column:i,text:$._('It looks like you have an extra ")"'),breaksCode:!1,source:"paramschecker"};return t.push(o),t}a[r.pop()]=i}if(r.length>0){var o={row:n,column:r.pop(),text:$._('It looks like you are missing a ")" - does every "(" have a corresponding closing ")"?'),breaksCode:!1,source:"paramschecker"};return t.push(o),t}var c=e.match(/\w+\s*\(/g)||[],s=e.match(/\.\s*\w+\s*\(/g)||[];s=_.map(s,function(e){var n=e.indexOf(e.match(/\w/g)[0]);return e.slice(n)});for(var i=c.length-1;i>=0;i--){var u=e.lastIndexOf(c[i]),l=c[i].split(/\(\s*/g)[0];u+=l.length;var f=e.slice(u,a[u]+1),m=f.match(/[A-z0-9]+\s+[A-z0-9]+/g);if(m){for(var d=e.indexOf(m[0]);" "!==e[d];)d++;var o={row:n,column:d,text:$._("Did you forget to add a comma between two parameters?"),breaksCode:!1,source:"paramschecker"};t.push(o);break}var h,v=f.match(/,/g);if(h=v?v.length+1:f.match(/[^\s()]/g)?1:0,!_.include(s,c[i])){l=l.replace(/\s/g,"");var b,g,y=BabyHint.functionParamCount[l];if("undefined"!=typeof y)if(g='"'+l+'()"',"number"==typeof y&&h!==y)b=$.ngettext("%(name)s takes 1 parameter, not %(given)s!","%(name)s takes %(num)s parameters, not %(given)s!",y,{name:g,given:h});else if("number"!=typeof y&&!_.include(y,h)){for(var p=""+y[0],k=1;k<y.length-1;k++)p+=", "+y[k];p+=" "+$._("or")+" "+y[y.length-1],b=$._("%(name)s takes %(list)s parameters, not %(given)s!",{name:g,list:p,given:h})}if(b){var H=BabyHint.functionFormSuggestion[l];H&&(b=$._("It looks like you're trying to use %(name)s. In case you forgot, you can use it like: %(usage)s",{name:g,usage:'"'+H+'"'}))}if(b){var o={row:n,column:u,text:b,breaksCode:!0,source:"paramschecker"};t.push(o)}}e=e.slice(0,u)+f.replace(/./g,"0")+e.slice(a[u]+1)}return t}};window.BabyHint=BabyHint;
window.OutputTester={tests:[],test:function(t,e,n){OutputTester.userCode=t,OutputTester.validate=e,OutputTester.tests=[],OutputTester.exec(OutputTester.validate,OutputTester.testContext),OutputTester.testResults=[],OutputTester.errors=n||[],OutputTester.curTask=null,OutputTester.curTest=null;for(var r=0;r<OutputTester.tests.length;r++)OutputTester.testResults.push(OutputTester.runTest(t||"",OutputTester.tests[r],r))},runTest:function(t,e){var n={name:e.name,state:"pass",results:[]};return OutputTester.curTest=n,OutputTester.validate&&"static"===e.type&&e.fn(),OutputTester.curTest=null,n},exec:function(t){function e(){for(var e=0;e<n.length;e++)n[e]&&(t="with(arguments["+e+"]){\n"+t+"\n}");return new Function(t).apply({},n),!0}if(!t)return!0;var n=Array.prototype.slice.call(arguments,1);return e()},testContext:{test:function(t,e,n){e||(e=t,t=$._("Test Case")),OutputTester.tests.push({name:t,type:n||"default",fn:function(){try{return e.apply(this,arguments)}catch(t){console.warn(t)}}})},staticTest:function(t,e){OutputTester.testContext.test(t,e,"static")},log:function(t,e,n,r,s){r=r||"info";var u={type:r,msg:t,state:e,expected:n,meta:s||{}};return OutputTester.curTest&&("pass"!==e&&(OutputTester.curTest.state=e),OutputTester.curTest.results.push(u)),OutputTester.curTask&&("pass"!==e&&(OutputTester.curTask.state=e),OutputTester.curTask.results.push(u)),u},task:function(t,e){OutputTester.curTask=OutputTester.testContext.log(t,"pass",e,"task"),OutputTester.curTask.results=[]},endTask:function(){OutputTester.curTask=null},assert:function(t,e,n,r){return t=!!t,OutputTester.testContext.log(e,t?"pass":"fail",n,"assertion",r),t},isEqual:function(t,e,n){return OutputTester.testContext.assert(t===e,n,[t,e])},hasFnCall:function(t,e){for(var n=0,r=OutputTester.fnCalls.length;r>n;n++){var s=OutputTester.testContext.checkFn(OutputTester.fnCalls[n],t,e);if(s===!0)return}OutputTester.testContext.assert(!1,$._("Expected function call to %(name)s was not made.",{name:t}))},orderedFnCalls:function(t){for(var e=0,n=0,r=OutputTester.fnCalls.length;r>n;n++){var s=OutputTester.testContext.checkFn(OutputTester.fnCalls[n],t[e][0],t[e][1]);if(s===!0&&(e+=1,e===t.length))return}OutputTester.testContext.assert(!1,$._("Expected function call to %(name)s was not made.",{name:t[e][0]}))},checkFn:function(t,e,n){if(t.name===e){var r=!0;if("object"==typeof n)if(n.length!==t.args.length)r=!1;else for(var s=0;s<n.length;s++)null!==n[s]&&n[s]!==t.args[s]&&(r=!1);else"function"==typeof n&&(r=n(t));return r&&OutputTester.testContext.assert(!0,$._("Correct function call made to %(name)s.",{name:e})),r}},pass:function(t){return{success:!0,message:t}},fail:function(t){return{success:!1,message:t}},anyPass:function(){return _.find(arguments,this.passes)||arguments[0]||this.fail()},allPass:function(){return _.find(arguments,this.fails)||arguments[0]||this.pass()},firstMatchingPattern:function(t){return _.find(t,_.bind(function(t){return this.matches(this.structure(t))},this))},passes:function(t){return t.success},fails:function(t){return!t.success},match:function(t){if(OutputTester.errors.length)return{success:!1,message:$._("Syntax error!")};if(t&&_.isUndefined(t.pattern)&&(t={pattern:t}),!t||!t.pattern)return{success:!1,message:""};try{var e,n=t.constraint;n&&(e={},e[n.variables.join(", ")]=n.fn);var r=Structured.match(OutputTester.userCode,t.pattern,{varCallbacks:e});return{success:r,message:e&&e.failure}}catch(s){return console.warn(s),{success:!0,message:$._("Hm, we're having some trouble verifying your answer for this step, so we'll give you the benefit of the doubt as we work to fix it. Please click 'Report a problem' to notify us.")}}},matches:function(t){return this.match(t).success},assertMatch:function(t,e,n,r,s){if(s){var u=_.any(OutputTester.errors,function(t){return t.lint});u&&_.each(s,function(t){var e,n=OutputTester.userCode.search(t.re),r=-1,s=-1;if(n>-1){e=t.msg;var u=OutputTester.userCode.split("\n"),a=0;_.each(u,function(t,e){-1===r&&n<a+t.length&&(r=e,s=n-a),a+=t.length}),OutputTester.errors.splice(0,1,{text:e,row:r,col:s,type:"error"})}})}var a,i;t.success?a=t.message:i=t.message,OutputTester.testContext.assert(t.success,e,"",{structure:_.isString(n)?"function() {"+n+"}":n.toString(),alternateMessage:a,alsoMessage:i,image:r})},structure:function(t,e){return{pattern:t,constraint:e}},constraint:function(t,e){return{variables:t,fn:e}},_isVarName:function(t){return _.isString(t)&&t.length>0&&"$"===t[0]},_assertVarName:function(t){if(!this._isVarName(t))throw new Error("Expected "+t+" to be a valid variable name.")},unaryOp:function(t,e){return this._assertVarName(t),this.constraint([t],function(t){return!(!t||_.isUndefined(t.value)||!e(t.value))})},isLiteral:function(t){function e(){return!0}return this.unaryOp(t,e)},isNumber:function(t){return this.unaryOp(t,_.isNumber)},isIdentifier:function(t){return this.constraint([t],function(t){return!(!t||!t.type||"Identifier"!==t.type)})},isBoolean:function(t){return this.unaryOp(t,_.isBoolean)},isString:function(t){return this.unaryOp(t,_.isString)},binaryOp:function(t,e,n){var r,s=[];if(this._isVarName(t))s.push(t),this._isVarName(e)?(s.push(e),r=function(t,e){return!(!t||!e||_.isUndefined(t.value)||_.isUndefined(e.value)||!n(t.value,e.value))}):r=function(t){return!(!t||_.isUndefined(t.value)||!n(t.value,e))};else{if(!this._isVarName(e))throw new Error("Expected either "+t+" or "+e+" to be a valid variable name.");s.push(e),r=function(e){return!(!e||_.isUndefined(e.value)||!n(t,e.value))}}return this.constraint(s,r)},lessThan:function(t,e){return this.binaryOp(t,e,function(t,e){return e>t})},lessThanOrEqual:function(t,e){return this.binaryOp(t,e,function(t,e){return e>=t})},greaterThan:function(t,e){return this.binaryOp(t,e,function(t,e){return t>e})},positive:function(t){return this.unaryOp(t,function(t){return t>0})},negative:function(t){return this.unaryOp(t,function(t){return 0>t})},greaterThanOrEqual:function(t,e){return this.binaryOp(t,e,function(t,e){return t>=e})},inRange:function(t,e,n){return this.and(this.greaterThanOrEqual(t,e),this.lessThanOrEqual(t,n))},equal:function(t,e){return this.binaryOp(t,e,function(t,e){return t===e})},notEqual:function(t,e){return this.binaryOp(t,e,function(t,e){return t!==e})},not:function(t){return this.constraint(t.variables,function(){return!t.fn.apply({},arguments)})},_naryShortCircuitingOp:function(t,e){var n=_.union.apply({},_.pluck(e,"variables")),r=_.object(_.map(n,function(t,e){return[t,e]}));return this.constraint(n,function(){var n=arguments;return t(e,function(t){var e=_.map(t.variables,function(t){return n[r[t]]});return t.fn.apply({},e)})})},and:function(){return this._naryShortCircuitingOp(_.all,arguments)},or:function(){return this._naryShortCircuitingOp(_.any,arguments)}}};
!function(){var t,e,n={recording:!1,init:function(t){this.id=t||"output",this.$elem=$("#"+t),this.validate=null,this.errors=[],this.context={},this.loaded=!1,this.config=new ScratchpadConfig({}),this.config.runCurVersion("jshint"),this.config.on("versionSwitched",function(t,e){this.config.runVersion(e,"processing",CanvasOutput.canvas)}.bind(this)),n.bind(),n.setOutput(CanvasOutput),BabyHint.init()},bind:function(){window!==window.top&&(window.alert=$.noop,window.open=$.noop,window.showModalDialog=$.noop,window.confirm=$.noop,window.prompt=$.noop,window.eval=$.noop),window.addEventListener("message",this.handleMessage.bind(this),!1)},handleMessage:function(r){var o;t=r.source,e=r.origin,this.notifyActive();try{o=JSON.parse(r.data)}catch(a){return}if(n.execDir=o.execDir,n.externalsDir=o.externalsDir,n.imagesDir=o.imagesDir,null!=o.validate&&n.initTests(o.validate),null!=o.settings&&(n.settings=o.settings),null!=o.code&&(this.config.switchVersion(o.version),n.runCode(o.code)),n.onlyRunTests=null!=o.onlyRunTests?!!o.onlyRunTests:!1,o.restart&&n.restart(),o.screenshot){var s=document.createElement("canvas"),u=o.screenshotSize||200;s.width=u,s.height=u,s.getContext("2d").drawImage($("#output-canvas")[0],0,0,u,u),t.postMessage(s.toDataURL("image/png"),e)}null!=o.recording&&(n.recording=o.recording),o.action&&CanvasOutput.handlers[o.name]&&CanvasOutput.handlers[o.name](o.action),o.documentation&&BabyHint.initDocumentation(o.documentation)},postParent:function(n){t&&t.postMessage(JSON.stringify(n),e)},notifyActive:_.once(function(){this.postParent({active:!0})}),initTests:function(t){if(n.validate!==t){n.validate=t;var e=n.exec(t,OutputTester.testContext);e&&e.message?$("#test-errors").text(e.message).show():$("#test-errors").hide()}},setOutput:function(t){n.output&&n.output.kill(),n.output=t.init({config:this.config})},registerOutput:function(t){n.outputs||(n.outputs=[]),n.outputs.push(t),$.extend(n.testContext,t.testContext)},getUserCode:function(){return n.currentCode||""},exposedProps:function(){return n.output?n.output.props:{}},bannedProps:function(){return n.output?n.output.bannedProps:{}},propListString:function(t){var e=n.bannedProps(),r=[];for(var o in t)e[o]||r.push(o+":"+t[o]);return r.join(",")},runCode:function(t,e){n.currentCode=t;var r="/*jshint "+n.propListString(n.JSHint)+" *//*global "+n.propListString(n.exposedProps())+"*/\n"+t,o=function(r,o){n.hintDone(t,r,o,e)};t?n.hintWorker.exec(r,o):o(null,[])},hintDone:function(t,e,r,o){var a=n.exposedProps();if(n.globals={},e&&e.globals)for(var s=0,u=e.globals.length;u>s;s++){var i=e.globals[s];a[i]||i in n.context||(n.context[i]=void 0),n.globals[i]=!0}n.babyErrors=BabyHint.babyErrors(t,r),n.errors=[],n.mergeErrors(r,n.babyErrors);var c=function(){return n.loaded||(this.postParent({loaded:!0}),n.loaded=!0),o?void o(n.errors):(this.postParent({results:{code:t,errors:n.errors,tests:n.testResults||[]}}),void n.toggleErrors())}.bind(this);if(n.globals={},e&&e.globals)for(var s=0,u=e.globals.length;u>s;s++){var i=e.globals[s];a[i]||i in n.context||(n.context[i]=void 0),n.globals[i]=!0}var p=function(){if(0===n.errors.length&&!n.onlyRunTests){if(n.output&&n.output.runCode){try{n.output.runCode(t,n.context,c)}catch(e){n.handleError(e),c()}return}n.exec(t,n.context)}c()};n.testWorker.exec(t,n.validate,n.errors,p)},mergeErrors:function(t,e){var r=[],o=[];_.each(t,function(t){t&&t.line&&t.character&&t.reason&&!/unable to continue/i.test(t.reason)&&(r.push(t.line-2),o.push({row:t.line-2,column:t.character-1,text:_.compose(n.prettify,n.clean)(t.reason),type:"error",lint:t,source:"jshint"}))}),_.each(e,function(t){(_.include(r,t.row)||t.breaksCode)&&n.errors.push({row:t.row,column:t.column,text:_.compose(n.prettify,n.clean)(t.text),type:"error",source:t.source})}),n.errors=n.errors.concat(o)},toggleErrors:function(){var t=!!n.errors.length;$("#show-errors").toggleClass("ui-state-disabled",!t),$("#output .error-overlay").toggle(t),n.toggle(!t),t?(n.errors=n.errors.sort(function(t,e){return t.row-e.row}),n.errorDelay&&clearTimeout(n.errorDelay),n.errorDelay=setTimeout(function(){n.errors.length>0&&$("#output").showTip("Error",n.errors)},1500)):$("#output").hideTip("Error")},trackFunctions:function(){n.tracking={},n.fnCalls=[],_.each(n.context,function(t,e){"function"==typeof t&&(n.tracking[e]=t,n.context[e]=function(){var t=n.tracking[e].apply(n.context,arguments);return n.fnCalls.push({name:e,args:Array.prototype.slice.call(arguments),retVal:t}),t})})},endTrackFunctions:function(){_.each(n.tracking,function(t,e){n.context[e]=t}),n.tracking={}},toggle:function(t){n.output&&n.output.toggle&&n.output.toggle(t)},start:function(){n.output&&n.output.start&&n.output.start()},stop:function(){n.output&&n.output.stop&&n.output.stop()},restart:function(){n.output&&n.output.restart&&n.output.restart()},clear:function(){n.output&&n.output.clear&&n.output.clear()},handleError:function(t){if(n.testing){var e=$._("Error: %(message)s",{message:t.message});return $("#test-errors").text(e).show(),void OutputTester.testContext.assert(!1,e,$._("A critical problem occurred in your program making it unable to run."))}var r=t.lineno?t.lineno-2:-1;_.each(n.babyErrors,function(t){t.row+1===r&&n.errors.push({row:t.row,column:t.column,text:_.compose(n.prettify,n.clean)(t.text),type:"error"})}),n.errors.push({row:r,column:0,text:n.clean(t.message),type:"error"}),n.toggleErrors()},exec:function(t){function e(){var e=function(){return"__env__"+Math.floor(1e9*Math.random())};n.output&&n.output.compile&&(t=n.output.compile(t));for(var o=e(),a=0;a<r.length;a++)r[a]&&(t="with("+o+"["+a+"]){\n"+t+"\n}");var s=$._("This program uses capabilities we've turned off for security reasons. Khan Academy prohibits showing external images, playing sounds, or displaying pop-ups."),u="{ get externals() { throw { message: "+JSON.stringify(s)+" } } }";return t="var "+o+" = arguments;\n(function(){\n"+t+"\n}).apply("+u+");",new Function(t).apply(n.context,r),!0}if(!t)return!0;var r=Array.prototype.slice.call(arguments,1);try{return e()}catch(o){return n.handleError(o),o}},stringify:function(t){return"function"==typeof t?t.toString():t&&t.__id?t.__id():t&&"[object Array]"===Object.prototype.toString.call(t)?n.stringifyArray(t):"undefined"==typeof t?"undefined":JSON.stringify(t,function(t,e){return e&&(void 0!==e.id&&"output-canvas"===e.id||"undefined"!=typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D)?void 0:e})},stringifyArray:function(t){for(var e=[],r=0,o=t.length;o>r;r++)e.push(n.stringify(t[r]));return e.join(", ")},applyInstance:function(t,e){try{var r=(/^function\s*(\w+)/.exec(t)||[])[1];if(r&&window[r]===t)return t}catch(o){}return!t.__name&&e&&(t.__name=e),function(){function e(){t.apply(this,r)}var r=arguments;e.prototype=t.prototype;var o=new e;return o.constructor=t,o.__id=function(){return"new "+t.__name+"("+n.stringifyArray(r)+")"},n.instances&&n.instances.push(o),o}}};window.Output=n,window.CanvasOutput={trackedMouseEvents:["move","over","out","down","up"],bannedProps:{externals:!0},drawLoopMethods:["draw","mouseClicked","mouseDragged","mouseMoved","mousePressed","mouseReleased","mouseScrolled","mouseOver","mouseOut","touchStart","touchEnd","touchMove","touchCancel","keyPressed","keyReleased","keyTyped"],liveReset:{background:[255,255,255],colorMode:[1],ellipseMode:[3],fill:[255,255,255],frameRate:[60],imageMode:[0],rectMode:[0],stroke:[0,0,0],strokeCap:["round"],strokeWeight:[1],textAlign:[37,0],textAscent:[9],textDescent:[12],textFont:["Arial",12],textLeading:[14],textSize:[12]},init:function(t){if(this.config=t.config,this.$elem=$("#output-canvas"),0===this.$elem.length&&(this.$elem=$("<canvas>").attr("id","output-canvas").appendTo("body")),this.$elem.show(),CanvasOutput.bind(),CanvasOutput.reseedRandom(),CanvasOutput.lastGrab=null,CanvasOutput.build(this.$elem[0]),!CanvasOutput.props){var e=CanvasOutput.props={},r=CanvasOutput.safeCalls={};for(var o in n.context)if(o.indexOf("__")<0){var a=n.context[o],s="function"==typeof a;if(e[o]=!(/^[A-Z]/.test(o)||"height"===o||"width"===o||"key"===o||s&&o.indexOf("key")<0),s)try{var u=String(a);(/native code/.test(u)||/return /.test(u)&&!/p\./.test(u)&&!/new P/.test(u))&&(r[o]=!0)}catch(i){}}r.PVector=!0,e.draw=!0}return this},bind:function(){var t=this.$elem.offset();jQuery.each(CanvasOutput.trackedMouseEvents,function(e,r){var o="mouse"+r;CanvasOutput.$elem.bind(o,function(e){if(n.recording){var o={};o[r]={x:e.pageX-t.left,y:e.pageY-t.top},n.postParent({log:o})}}),CanvasOutput.handlers[r]=function(e){var n=e[r],a=n.x+t.left,s=n.y+t.top,u=a-$(window).scrollLeft(),i=s-$(window).scrollTop(),c=document.createEvent("MouseEvents");c.initMouseEvent(o,!0,!0,window,0,0,0,u,i,!1,!1,!1,!1,0,document.documentElement),CanvasOutput.$elem[0].dispatchEvent(c)}}),$(window).on("resize",function(){var t=$(window),e=t.width(),r=t.height();(e!==CanvasOutput.canvas.width||r!==CanvasOutput.canvas.height)&&($("#output-canvas").width(e).height(r),CanvasOutput.canvas.size(e,r),n.restart())})},handlers:{},build:function(t){CanvasOutput.canvas=n.context=new Processing(t,function(t){t.draw=CanvasOutput.DUMMY}),$.extend(CanvasOutput.canvas,CanvasOutput.processing),this.config.runCurVersion("processing",CanvasOutput.canvas),CanvasOutput.clear(),$(window).resize()},imageCache:{},imagesCached:!1,imageCacheStarted:!1,imageHolder:null,cacheImages:function(t,e){var r=t.match(/getImage\s*\(.*?\)/g),o=0;CanvasOutput.imageHolder||(CanvasOutput.imageHolder=$("<div>").css({height:0,width:0,overflow:"hidden",position:"absolute"}).appendTo("body"));var a=function(){o+=1,o===r.length&&e()};_.each(r,function(t){var e=/"([A-Za-z0-9_\/-]*?)"/.exec(t);if(CanvasOutput.imageCache[t]||!e)return a();t=e[1];var r=n.imagesDir+t+".png",o=document.createElement("img");o.onload=a,o.src=r,CanvasOutput.imageHolder.append(o),CanvasOutput.imageCache[t]=o})},processing:{Object:window.Object,RegExp:window.RegExp,Math:window.Math,Array:window.Array,String:window.String,getImage:function(t){var e=CanvasOutput.imageCache[t];if(!e)return n.handleError({message:$._("Image '%(file)s' was not found.",{file:t})});var r=new CanvasOutput.canvas.PImage(e);return r.__id=function(){return"getImage('"+t+"')"},r},loadImage:function(){n.handleError({message:"Use getImage instead of loadImage."})},requestImage:function(){n.handleError({message:"Use getImage instead of requestImage."})},link:function(){n.handleError({message:$._("link() method is disabled.")})},debug:function(){console.log.apply(console,arguments)},Program:{settings:function(){return n.settings||{}},restart:function(){n.restart()},runTests:function(){return n.test(),n.testResults},runTest:function(t,e){1===arguments.length&&(e=t,t="");var r=!!e();n.postParent({results:{code:n.currentCode,errors:[],tests:[{name:t,state:r?"pass":"fail",results:[]}]},pass:r})}}},DUMMY:function(){},preTest:function(){CanvasOutput.oldContext=n.context,CanvasOutput.testingContext?CanvasOutput.canvas=n.context=CanvasOutput.testingContext:(CanvasOutput.testCanvas=document.createElement("canvas"),CanvasOutput.build(CanvasOutput.testCanvas),CanvasOutput.testingContext=n.context)},postTest:function(){return CanvasOutput.canvas=n.context=CanvasOutput.oldContext,CanvasOutput.testCanvas},runTest:function(){},runCode:function(t,e,r){function o(){if(window.Worker){var e={};_.each(n.globals,function(t,r){var o=n.context[r];e[r]="function"==typeof o||"Math"===r?"__STUBBED_FUNCTION__":"object"!=typeof o||$.isPlainObject(o)?o:{}}),n.worker.exec(t,e,function(t){try{CanvasOutput.injectCode(t,r)}catch(e){n.handleError(e),r()}})}else CanvasOutput.injectCode(t,r)}n.globals.getImage?CanvasOutput.cacheImages(t,o):o()},hasOrHadDrawLoop:function(){for(var t=0,e=this.drawLoopMethods.length;e>t;t++){var r=this.drawLoopMethods[t];if(n.globals[r]||CanvasOutput.lastGrab&&CanvasOutput.lastGrab[r])return!0}return!1},drawLoopMethodDefined:function(){for(var t=0,e=this.drawLoopMethods.length;e>t;t++){var r=this.drawLoopMethods[t];if(n.context[r]!==CanvasOutput.DUMMY&&void 0!==n.context[r])return!0}return!1},injectCode:function(t,e){var r={},o=[],a=!1,s={},u={},i=CanvasOutput.props,c="";CanvasOutput.grabObj={},n.instances=[],t=t&&t.replace(/\bnew[\s\n]+([A-Z]{1,2}[a-z0-9_]+)([\s\n]*\()/g,"Output.applyInstance($1,'$1')$2");var p=CanvasOutput.hasOrHadDrawLoop();if(p){if(_.each(n.globals,function(t,e){var a=n.context[e];r[e]="function"!=typeof a||CanvasOutput.safeCalls[e]?a:function(){return o.push([e,arguments]),0}}),!n.exec(t,r))return;_.each(r,function(t,e){"function"==typeof t&&(t.__name=e)});for(var l=0,d=n.instances.length;d>l;l++)u[n.instances[l].constructor.__name]=!0;n.oldInstances&&n.stringifyArray(n.oldInstances)!==n.stringifyArray(n.instances)&&(a=!0),n.oldInstances=n.instances,n.instances=null;for(var l=0;l<o.length;l++){var f=Array.prototype.slice.call(o[l][1]);c+=o[l][0]+"("+n.stringifyArray(f)+");\n"}_.each(r,function(t,e){try{r[e]=n.stringify(r[e]),!CanvasOutput.lastGrab||i[e]===!1||e in CanvasOutput.lastGrab&&r[e]===CanvasOutput.lastGrab[e]||("function"==typeof t?(u[e]&&(a=!0),s[e]=!0,c+="var "+e+" = "+r[e]+";\n",c+=e+".__name = '"+e+"';\n"):n.context[e]=t),"function"==typeof t&&i[e]!==!1&&(CanvasOutput.objectExtract(e,t),CanvasOutput.objectExtract(e,t,"prototype"))}catch(o){CanvasOutput.objectExtract(e,t)}}),_.each(CanvasOutput.grabObj,function(t,e){var n=/^[^.[]*/.exec(e)[0];(!CanvasOutput.lastGrabObj||CanvasOutput.lastGrabObj[e]!==t||s[n])&&(c+=e+" = "+t+";\n")});for(var v in CanvasOutput.lastGrabObj)v in CanvasOutput.grabObj||(c+="delete "+v+";\n");for(var g in CanvasOutput.lastGrab)g in r||g in CanvasOutput.props&&"draw"!==g||(c+="delete Output.context."+g+";\n","draw"===g&&CanvasOutput.clear())}if(n.context.resetMatrix(),CanvasOutput.restoreRandomSeed(),CanvasOutput.lastGrab)for(var h in CanvasOutput.liveReset)!n.globals[h]&&CanvasOutput.lastGrab[h]&&CanvasOutput.canvas[h].apply(CanvasOutput.canvas,CanvasOutput.liveReset[h]);if(p&&CanvasOutput.drawLoopMethodDefined()&&CanvasOutput.lastGrab&&!a?c&&(n.globals.draw&&(c+="\ndraw();"),n.exec(c,n.context)):(CanvasOutput.clear(),n.globals.draw&&(t+="\ndraw();"),n.exec(t,n.context),_.each(n.globals,function(t,e){"function"==typeof t&&(t.__name=e)})),n.context.draw||(n.context.draw=CanvasOutput.DUMMY),p&&(CanvasOutput.lastGrab=r,CanvasOutput.lastGrabObj=CanvasOutput.grabObj),e)try{e()}catch(w){}},objectExtract:function(t,e,r){n.context[t]||(n.context[t]=$.isArray(e)?[]:{}),r&&(e=e[r]);for(var o in e)if(e.hasOwnProperty(o)&&o.indexOf("__")<0)if("function"==typeof e[o])CanvasOutput.grabObj[t+(r?"."+r:"")+"['"+o+"']"]=n.stringify(e[o]);else{var a=n.context[t];r&&(a=a[r]),a[o]=e[o]}},restart:function(){CanvasOutput.lastGrab=null,CanvasOutput.lastGrabObj=null,CanvasOutput.reseedRandom(),CanvasOutput.canvas.frameCount=0,n.runCode(n.getUserCode())},testContext:{testCanvas:function(t,e){n.testContext.test(t,e,CanvasOutput)}},toggle:function(t){t?CanvasOutput.start():CanvasOutput.stop()},stop:function(){CanvasOutput.canvas.noLoop()},start:function(){CanvasOutput.canvas.loop()},clear:function(){for(var t in CanvasOutput.liveReset)CanvasOutput.liveReset.hasOwnProperty(t)&&CanvasOutput.canvas[t].apply(CanvasOutput.canvas,CanvasOutput.liveReset[t])},seed:null,reseedRandom:function(){CanvasOutput.seed=Math.floor(4294967296*Math.random())},restoreRandomSeed:function(){CanvasOutput.canvas.randomSeed(CanvasOutput.seed)},kill:function(){CanvasOutput.canvas.exit(),CanvasOutput.$elem.hide()}},n.registerOutput(CanvasOutput),n.prettify=function(t){t=t.split('"');for(var e="",n=0;n<t.length;n++)e+=n%2===0?'<span class="text">'+t[n]+"</span>":'<span class="quote">'+t[n]+"</span>";return e},n.clean=function(t){return String(t).replace(/</g,"&lt;")};var r=function(t,e){this.pool=[],this.curID=0,this.filename=t,this.onExec=e||function(){}};if(r.prototype.getURL=function(){return n.execDir+this.filename+"?cachebust=B"+(new Date).toDateString()},r.prototype.getWorkerFromPool=function(){var t=this.pool.shift();return t||(t=new window.Worker(this.getURL())),this.curID+=1,t.id=this.curID,t},r.prototype.isCurrentWorker=function(t){return this.curID===t.id},r.prototype.addWorkerToPool=function(t){this.pool.push(t)},r.prototype.exec=function(){this.onExec.apply(this,arguments)},n.testWorker=new r("test-worker.js",function(t,e,r,o){var a=this;n.testing=!0;var s=function(t){n.testResults=t.testResults,n.errors.concat(t.errors),n.testing=!1};if(!window.Worker||r.length>0)return OutputTester.test(t,e,r),s(OutputTester),void o();var u=this.getWorkerFromPool();u.onmessage=function(t){if("test"===t.data.type){if(a.isCurrentWorker(u)){var e=t.data.message;s(e),o()}a.addWorkerToPool(u)}},u.postMessage({code:t,validate:e,errors:r,externalsDir:n.externalsDir})}),n.hintWorker=new r("jshint-worker.js",function(t,e){if(!window.Worker)return JSHINT(t),void e(JSHINT.data(),JSHINT.errors);var r=this,o=this.getWorkerFromPool();o.onmessage=function(t){if("jshint"===t.data.type){if(r.isCurrentWorker(o)){var n=t.data.message;e(n.hintData,n.hintErrors)}r.addWorkerToPool(o)}},o.postMessage({code:t,externalsDir:n.externalsDir})}),n.worker={timeout:null,running:!1,init:function(){var t=n.worker.worker=new window.Worker(n.execDir+"worker.js?cachebust="+(new Date).toDateString());t.onmessage=function(t){t.data.execStarted?n.worker.timeout=window.setTimeout(function(){n.worker.stop(),n.worker.done({message:$._("The program is taking too long to run. Perhaps you have a mistake in your code?")})},500):"end"===t.data.type?n.worker.done():"error"===t.data.type&&n.worker.done({message:t.data.message})},t.onerror=function(t){t.preventDefault(),n.worker.done(t)}},exec:function(t,e,r){n.worker.running&&n.worker.stop(),n.worker.worker||n.worker.init(),n.worker.done=function(e){n.worker.running=!1,n.worker.clearTimeout(),e?(n.handleError(e),r()):r(t)};try{n.worker.worker.postMessage({code:t,context:e}),n.worker.running=!0}catch(o){n.worker.done()}},clearTimeout:function(){null!==n.worker.timeout&&(window.clearTimeout(n.worker.timeout),n.worker.timeout=null)},stop:function(){return n.worker.clearTimeout(),n.worker.worker?(n.worker.worker.terminate(),n.worker.worker=null,!0):!1}},window!==window.top&&Object.freeze&&Object.getOwnPropertyDescriptor){for(var o in window)if(window.hasOwnProperty(o))try{var a=Object.getOwnPropertyDescriptor(window,o);(!a||a.configurable)&&Object.defineProperty(window,o,{value:window[o],writable:!1,configurable:!1})}catch(s){}var u=navigator.userAgent.toLowerCase();if(/chrome/.test(u))Object.freeze(window.location),Object.freeze(window);else if(/safari/.test(u))Object.seal(window);else{var a=Object.getOwnPropertyDescriptor(window);(!a||a.configurable)&&Object.freeze(window)}Object.freeze(Object.getPrototypeOf(window))}}();