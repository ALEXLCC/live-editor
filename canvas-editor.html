<!DOCTYPE html>
<html>
<head>
	<title>Canvas Video</title>
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/ui-lightness/jquery-ui.css" />
	<script src="js/jquery.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js"></script>
	<script src="js/jquery.simulate.js"></script>
	<script src="js/require.js"></script>
	<script src="js/record.js"></script>
	<script src="js/editor.js"></script>
	<script src="js/canvas.js"></script>
	<script src="js/test.js"></script>
	<script id="code">	
	$(function(){
		// Start the editor and canvas drawing area
		Editor.init();
		Canvas.init();

		$("#toolbar div.color").each(function() {
			$(this).children().css( "background-color", this.id );
		});

		$("#toolbar").delegate( "div.color", "click", function() {
			Canvas.setColor( this.id );
		});

		$("#draw").toggle( Canvas.startDraw, Canvas.endDraw );
		
		$("#clear").click( Canvas.clear );
		
		$("#test").click(function() {
			var testObj = { test: "" };
			
			Record.log( testObj );
			
			var numTest = $("#tests h3").length + 1;
			
			$( $("#form-tmpl").html() )
				.find( "a" ).text( "Exercise #" + numTest ).end()
				.find( "input" ).val( "Exercise #" + numTest ).end()
				.appendTo( "#tests" )
				.find( "form" ).change(function( e ) {
					var elem = e.target;
					
					console.log( e );
					
					testObj[ elem.name ] = elem.value;
					
					if ( elem.name === "title" ) {
						$(this).parent().prev().find("a").text( elem.value );
					}
				});
			
			$("#tests").accordion( "destroy" ).accordion({ active: ":last" });
		});
		
		$(Canvas).bind({
			drawStarted: function() {
				$("#canvas, #editor").addClass( "canvas" );
				$("#draw span").text( "Code" );
			},
			
			drawEnded: function() {
				$("#canvas, #editor").removeClass( "canvas" );
				$("#draw span").text( "Draw" );
			},
			
			colorSet: function( e, color ) {
				$("div.color.active").removeClass("active");

				if ( color != null ) {
					$("#" + color).addClass("active");
				}
			}
		});
		
		$("#record").toggle(function() {
			// Begin recording the user's interactions
			Record.record();
			
			$(this).addClass("recording")
				.find("span").text( "Recording" );

		}, function() {
			// Reset the editor and canvas to its initial state
			Editor.reset();
			Canvas.endDraw();
			
			// Begin playing back the editor and canvas commands
			Record.play();
			
			$(this).removeClass("recording").addClass("playing")
				.find("span").text( "Playing" );
		});
		
		$(Record).bind({
			playEnded: function() {
				$("#record").removeClass("playing")
					.find("span").text( "Record" );
			}
		});
	});
	</script>
</head>
<body>
	<div id="toolbar">
		<div class="button wide" id="draw"><span class="icon">Draw</span></div>
		<div class="button wide" id="record"><span class="icon">Record</span></div>
		<div class="space"></div>
		<div class="color" id="black"><span class="icon"></span></div>
		<div class="color" id="red"><span class="icon"></span></div>
		<div class="color" id="orange"><span class="icon"></span></div>
		<div class="color" id="green"><span class="icon"></span></div>
		<div class="color" id="blue"><span class="icon"></span></div>
		<div class="color" id="lightblue"><span class="icon"></span></div>
		<div class="color" id="violet"><span class="icon"></span></div>
		<div class="space"></div>
		<div class="button" id="clear"><span class="icon"></span></div>
		<div class="button wide" id="test"><span class="icon">Test</span></div>
	</div>
	<div id="canvas-editor">
		<div id="editor" style="width: 600px; height: 480px;"></div>
		<canvas id="canvas" width="600" height="480"></canvas>
	</div>
	<div id="tests"></div>
	<script type="text/html" id="form-tmpl">
		<h3><a href='#'>Exercise</a></h3>
		<div>
			<form action="" method="POST">
				<input type="text" placeholder="Title" name="title" /><br/>
				<textarea name="desc" placeholder="Description"></textarea><br/>
				<textarea name="validate" placeholder="Validation"></textarea>
			</form>
		</div>
	</script>
</body>
</html>
